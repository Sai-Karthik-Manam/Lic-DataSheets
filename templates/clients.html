<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>All Clients | LIC Manager</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .clients-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .clients-count {
      padding: 15px 25px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 15px;
      font-weight: 600;
      font-size: 18px;
    }
    
    .clients-table-container {
      background: white;
      border-radius: 20px;
      overflow: visible;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      width: 100%;
    }
    
    .clients-table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .clients-table thead {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    
    .clients-table th {
      padding: 18px 15px;
      text-align: left;
      font-weight: 600;
      font-size: 14px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    
    .clients-table td {
      padding: 18px 15px;
      border-bottom: 1px solid #e9ecef;
      color: #333;
      font-size: 15px;
    }
    
    .clients-table tbody tr:hover {
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    }
    
    .client-name-cell {
      font-weight: 600;
      color: #667eea;
      cursor: pointer;
    }
    
    .client-name-cell:hover {
      text-decoration: underline;
    }
    
    .doc-badge {
      display: inline-block;
      padding: 5px 12px;
      background: #e7f3ff;
      color: #0057a0;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }
    
    .date-cell {
      color: #666;
      font-size: 14px;
    }
    
    .action-cell {
      display: flex;
      gap: 8px;
    }
    
    .btn-view {
      padding: 8px 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-view:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }
    
    .btn-edit {
      padding: 8px 15px;
      background: #ffc107;
      color: #333;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      transition: all 0.3s ease;
    }
    
    .btn-edit:hover {
      background: #ffb300;
      transform: translateY(-2px);
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
    }

    @media (max-width: 768px) {
      .clients-table-container {
        overflow-x: auto;
      }
      
      .action-cell {
        flex-direction: column;
      }
    }
  </style>
</head>
<body>
  <div class="container" style="max-width: 1200px;">
    <div class="clients-header">
      <h1 style="margin: 0;">👥 All Clients</h1>
      {% if not is_search and clients|length == 20 %}
        <div style="padding: 15px; background: #e7f3ff; border-radius: 10px; margin-bottom: 20px; font-size: 14px; color: #0057a0;">
          📌 Showing 20 most recently updated clients. <strong>Search for a specific client name to see all results.</strong>
        </div>
      {% elif is_search %}
        <div style="padding: 15px; background: #d4edda; border-radius: 10px; margin-bottom: 20px; font-size: 14px; color: #155724;">
          🔍 Showing search results for: <strong>"{{ search_query }}"</strong>
        </div>
      {% endif %}
      <div class="clients-count">
        📊 Total: {{ clients|length }} Clients
      </div>
    </div>

    {% if clients and clients|length > 0 %}
      <div class="clients-table-container">
        <table class="clients-table" id="clientsTable">
          <thead>
            <tr>
              <th>#</th>
              <th>👤 Client Name</th>
              <th>📄 Documents</th>
              <th>📅 Created</th>
              <th>📝 Updated</th>
              <th>⚡ Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for client in clients %}
            <tr>
              <td>{{ loop.index }}</td>
              <td>
                <span class="client-name-cell" onclick="viewClientData('{{ client[1] }}')">
                  {{ client[1] }}
                </span>
              </td>
              <td>
                <span class="doc-badge">{{ client[4] }} doc{{ 's' if client[4] != 1 else '' }}</span>
              </td>
              <td class="date-cell">
                {% if client[2] %}
                  {{ client[2].strftime('%Y-%m-%d') if client[2].__class__.__name__ == 'datetime' else client[2][:10] }}
                {% endif %}
              </td>
              <td class="date-cell">
                {% if client[3] %}
                  {{ client[3].strftime('%Y-%m-%d') if client[3].__class__.__name__ == 'datetime' else client[3][:10] }}
                {% endif %}
              </td>
              <td>
                <div class="action-cell">
                  <button class="btn-edit" onclick="editClientModal('{{ client[0] }}', '{{ client[1] }}')">
                    ✏️ Edit
                  </button>
                  <button class="btn-view" onclick="viewClientData('{{ client[1] }}')">
                    👁️ View
                  </button>
                </div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    {% else %}
      <div class="empty-state">
        <div style="font-size: 80px; margin-bottom: 20px; opacity: 0.5;">👥</div>
        <h2>No Clients Yet</h2>
        <p style="color: #666; margin: 15px 0;">
          Sync your Google Drive to see all your clients.
        </p>
        <a href="/manual-sync" class="link" style="display: inline-block; margin-top: 20px; padding: 12px 24px; background: #667eea; color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">
          🔄 Sync Google Drive Now
        </a>
      </div>
    {% endif %}

    <div style="margin-top: 30px; display: flex; gap: 10px; flex-wrap: wrap;">
      <a href="/manual-sync" class="link" style="padding: 10px 20px; background: #667eea; color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">🔄 Manual Sync</a>
      <a href="/upload_page" class="link" style="padding: 10px 20px; background: #28a745; color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">📤 Upload Documents</a>
      <a href="/dashboard" class="link" style="padding: 10px 20px; background: #17a2b8; color: white; border-radius: 8px; text-decoration: none; font-weight: 600;">📈 Dashboard</a>
    </div>
  </div>

  <script>
    function viewClientData(clientName) {
      const form = document.createElement('form');
      form.method = 'POST';
      form.action = '/fetch_data';
      
      const nameInput = document.createElement('input');
      nameInput.type = 'hidden';
      nameInput.name = 'name';
      nameInput.value = clientName;
      form.appendChild(nameInput);
      
      document.body.appendChild(form);
      form.submit();
    }

    function editClientModal(clientId, currentName) {
      const newName = prompt('Edit client name.\n\nCurrent: ' + currentName + '\n\nEnter new name:', currentName);
      
      if (!newName || newName === currentName) {
        return;
      }
      
      if (newName.trim().length < 2) {
        alert('Client name must be at least 2 characters long');
        return;
      }
      
      const formData = new FormData();
      formData.append('new_name', newName.trim());
      
      fetch('/edit_client/' + clientId, {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          alert('Success: ' + data.message);
          location.reload();
        } else {
          alert('Error: ' + data.error);
        }
      })
      .catch(error => {
        alert('Error: ' + error.message);
      });
    }
  </script>
</body>
</html>